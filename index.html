<!DOCTYPE html>
<html>
<head>
<style>
.hand {
    width:1456px; height:140px;
    border:1px solid black;
    padding:4px;
    overflow-x:visible;
    white-space: nowrap
}
.card {
    border:1px solid black;
    margin-right:4px;
    width:100px; height:140px;
    display: inline-block;
}
.card:hover {
  transform: scale(2); /* (150% zoom - Note: if the zoom is too large, it will go outside of the viewport) */
}
</style>
<script>

var cards = null;
var game = null;

function load_cards()
{
    var xmlhttp = new XMLHttpRequest();
    xmlhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            cards = JSON.parse(this.responseText);
        }
    };

    xmlhttp.open("GET", "cards.json", true);
    xmlhttp.send();
}

function render(player)
{
    var html = "<div class='player'>";
    html += "<div class='hand'>";
    for (var deck in player.hand)
    {
        console.log(player.hand[deck]);
        for (var card in player.hand[deck])
        {
            var i = player.hand[deck][card];
            console.log(cards[deck][i]);
            var url = "assets/"+deck+"/"+encodeURI(cards[deck][i]);
            console.log(url);
            html += "<div class='card'>";
            var img = "<img src=\"" +url+ "\" style='max-width: 100%;max-height: 100%;'>";
            console.log(img);
            html += img;
            html += "</div>";
        }
    }
    html += '</div>';
    html += '</div>';
    document.getElementById('players').innerHTML += html;
}

function add_player(gamestate)
{
    var xmlhttp = new XMLHttpRequest();
    xmlhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            var result = JSON.parse(this.responseText);
            document.getElementById('c3').innerHTML = this.responseText;
            game = this.responseText;
            
            document.getElementById('players').innerHTML = "";
            for (var player in result.players)
                render(result.players[player]);
        }
    };

    xmlhttp.open("POST", "api/add_player.php", true);
    xmlhttp.send(gamestate);
}

function next(gamestate)
{
    var xmlhttp = new XMLHttpRequest();
    xmlhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            var result = JSON.parse(this.responseText);
            document.getElementById('c3').innerHTML = this.responseText;
            game = this.responseText;
            
            document.getElementById('players').innerHTML = "";
            for (var player in result.players)
                render(result.players[player]);
        }
    };

    xmlhttp.open("POST", "api/next.php", true);
    xmlhttp.send(gamestate);
}

function new_game()
{
    var xmlhttp = new XMLHttpRequest();
    xmlhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            var result = JSON.parse(this.responseText);
            document.getElementById('c2').innerHTML = this.responseText;
            game = this.responseText;
        }
    };

    xmlhttp.open("GET", "api/new.php", true);
    xmlhttp.send();
}

function start()
{
    load_cards();
    new_game();
}

</script>
</head>

<body onload="start()">
<div>
<div id="c2"> </div><hr>
<input type="button" onclick="add_player(game)" value="Add Player"/>
<input type="button" onclick="next(game)" value="Next"/>
<div id="c3"> </div><hr>
<div id="c4"> </div><hr>
<div id="players"> </div><hr>


</body>
</html>