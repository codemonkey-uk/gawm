<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">

<link rel="stylesheet" href="css/gawm.css">

<script src="js/gawm.js"></script>
<script src="js/gawm_txt.js"></script>
<script src="js/gawm_netqueue.js"></script>

<title>GAWM</title>
<script>

function start()
{
    document.getElementById('landing').style.display = "none";
    new_game(get_contenteditable('user_name'));
}

function join()
{
    var ugc = get_contenteditable('user_game_code');
    add_player(
        ugc, 
        get_contenteditable('user_name'),
        function(){
            document.getElementById('landing').style.display = "none";
            document.title = "GAWM #"+ugc;
            history.pushState(game_id,document.title,create_loadnurl());
        }
    );
}

function getParameterByName(name, url) 
{
    if (!url) url = window.location.href;
    name = name.replace(/[\[\]]/g, '\\$&');
    var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
        results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, ' '));
}

function reset()
{
    var url = window.location.protocol + "//"
        + window.location.hostname
        + window.location.pathname;
    window.location.replace(url);
}

function body_onload()
{
    // pre-fill editable
    var game_id = getParameterByName('ugc');
    if (game_id) document.getElementById('user_game_code').innerHTML = game_id;

    var name = getParameterByName('un');
    if (name) document.getElementById('user_name').innerHTML = name;

    var d = getParameterByName('d');
    if (d) document.getElementById('debug_div').style.display="block";
    
    gawm_load_txt(function() {
        var action = getParameterByName('a');  
        if (action == 'join_game') join();

        if (action == 'load_game')
        {
            reload(getParameterByName('pid'),game_id);
            document.getElementById('landing').style.display = "none";
        }
    });
}

</script>
</head>

<body onload="body_onload()">

<div id="debug_div" style="display: none;"></div>

<div id="loading_div">
<img width=50 height=50 src="assets/loading.gif" alt="rotating circles to indicate network activity">
</div>

<div id="landing">
  <div class="header">
    <h1>Getting Away With Murder</h1>
    <h2>A co-operative role-play game of drama, wit, and mystery.</h2>
  </div>
  <div class="about"><p>
  GAWM is not a video game. It is a story telling game played with a deck of cards around a table.</p>
  <p>This website replaces that pack of cards so you can play with your friends around the world from the safely of your home. 
  It is not a matchmaking service. GAWM is a 4-6 player game. You will need to organise with your friends.</p><p>
  This website doesn't provide VOIP or Video chat. You'll need to use some other service. There are lots out there.
  <a href="https://discord.gg/d2uMBST">We use discord</a>. </p><p> Got your friends? Let's go:
  </p></div>
  <div class="action">
  <div class="row">
   <span>Enter your name, </span><span id="user_name" class="edit" contenteditable="true">Player_1</span><span> and:</span>
   </div>
   <div>
   <button id="new_game" onclick="start()">Create</button> a 
   <!-- <span id="player_count" class="edit" contenteditable="true">4</span> player -->
   game, </div>
   <div>
   <button id="join_game" onclick="join()">Join</button> using a game id <span id="user_game_code" class="edit" contenteditable="true">0000</span>.
  </div>
  <div class="row">
   <a href='' class="button" role="button">How To Play</a>
   <a href='components.html' class="button" role="button">Take a Look</a> at the components.
  </div>   
  </div>
</div>

<div id="game_div"></div>
<div id="cardface_container"></div>

<div id="invite" class='action' style="display: none;">
<div>Game id: <b><span id='game_id'></span></b>. Have other players use this URL to join in:</div>
<div><textarea style='width: 50%; margin: auto;' id='invite_url_textarea'></textarea></div>
<div><a id='invite_url_a' class="button" role="button">Email It</a></div>
</div>

<div id="gameover" style="display: none;">
<div class='action'>
<div><h1>Thanks for Playing!</h1></div>
<button onclick='reset()'>Start Again</button>
</div></div>

<div class="footer">
Game Rules, Software and Content (c) 2016-2020 Joseph Fowler & Thaddaeus Frogley.<br>
The source code for this website is hosted on <a href="https://github.com/codemonkey-uk/gawm">github</a>.
</div>

<div id="snackbar"></div>

</body>
</html>
